
# Using a CUDA base image - updated to 11.8 for better security patches
FROM nvidia/cuda:11.8.0-cudnn8-devel-ubuntu22.04

# Adding labels for the GitHub Container Registry
LABEL org.opencontainers.image.title="python-dl"
LABEL org.opencontainers.image.description="Docker image for the use of Deep Learning Python packages in FH DaSL's WILDS"
LABEL org.opencontainers.image.version="1.0"
LABEL org.opencontainers.image.authors="wilds@fredhutch.org"
LABEL org.opencontainers.image.url=https://hutchdatascience.org/
LABEL org.opencontainers.image.documentation=https://getwilds.org/
LABEL org.opencontainers.image.source=https://github.com/getwilds/wilds-docker-library
LABEL org.opencontainers.image.licenses=MIT

# Set the shell option to fail if any command in a pipe fails
SHELL ["/bin/bash", "-o", "pipefail", "-c"]

# Installing Python
RUN apt-get update \
  && PYTHON3_VERSION=$(apt-cache policy python3 | grep Candidate | awk '{print $2}') \
  && PYTHON3_PIP_VERSION=$(apt-cache policy python3-pip | grep Candidate | awk '{print $2}') \
  && apt-get install -y --no-install-recommends \
  python3="${PYTHON3_VERSION}" \
  python3-pip="${PYTHON3_PIP_VERSION}" \
  && rm -rf /var/lib/apt/lists/*

# Installing necessary Python modules - updated torch to 2.6.0+ to fix CVE-2025-32434
RUN pip install --no-cache-dir numpy==1.26.4 seaborn==0.13.2 matplotlib==3.9.2 pandas==2.2.3 scikit-learn==1.5.2 \
    scipy==1.14.1 optuna==4.0.0 joblib==1.4.2 keras==3.6.0 tensorflow==2.17.0 torch==2.6.0

